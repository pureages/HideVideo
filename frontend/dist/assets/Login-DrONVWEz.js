import{u as F,a as T,o as $,c,b as e,F as q,r as z,t as n,d as a,w as R,e as L,f,v as C,g as j,h as H,i as I,j as i,k as O,l as M,m as Z,n as u,p as G}from"./index--Q4BRkWj.js";import{s as J}from"./setting-dMvJKkiB.js";import{_ as K,A as Q}from"./AppFooter-Deo1k4jp.js";const W={class:"login-page"},X={class:"login-bg"},Y={class:"bg-particles"},ee={class:"login-container"},te={class:"login-card"},se={class:"login-header"},oe={key:0,class:"login-protection-hint"},le={class:"form-group"},ae=["placeholder"],ne={class:"form-group"},ie=["placeholder"],re={class:"form-group"},ce={class:"captcha-row"},ue=["placeholder"],de=["innerHTML"],pe={class:"form-group remember-group"},ge={class:"checkbox-label"},ve={key:1,class:"error-message"},he={key:0},me=["disabled"],_e={key:0,class:"spinner-small"},fe={key:1},be={__name:"Login",setup(ye){const S=Z(),N=F(),{t:l,locale:B}=T();function P(o,s){var A;const t=((A=M.global.locale)==null?void 0:A.value)||M.global.locale||B.value||"zh-CN",d=M.global.messages;if(!d)return o;let p=d[t];if(!p&&t.includes("-")){const g=t.split("-")[0];p=d[g]}if(p||(p=d["zh-CN"]),!p)return o;const E=o.split(".");let r=p;for(const g of E)r=r==null?void 0:r[g];return r?(s&&Object.keys(s).forEach(g=>{r=r.replace(new RegExp("{{"+g+"}}","g"),s[g])}),r):o}const b=i(""),y=i(""),v=i(""),V=i(""),w=i(!1),h=i(""),m=i(!1),x=i(!1),_=i(0);async function k(){try{const o=await O.getCaptcha();V.value=o.svg}catch(o){console.error(o)}}$(async()=>{try{const o=await J.getLoginProtection();x.value=o.enabled,await k()}catch(o){console.error(o)}});function U(o){const s=(t,d)=>Math.random()*(d-t)+t;return{left:`${s(0,100)}%`,top:`${s(0,100)}%`,animationDelay:`${s(0,5)}s`,animationDuration:`${s(3,8)}s`}}async function D(){var o;h.value="",_.value=0,m.value=!0;try{await N.login(b.value,y.value,v.value,w.value),S.push("/")}catch(s){const t=(o=s.response)==null?void 0:o.data;h.value=(t==null?void 0:t.error)||l("login.loginFailed"),t!=null&&t.failed_attempts&&(_.value=t.failed_attempts),await k(),v.value=""}finally{m.value=!1}}return(o,s)=>(u(),c("div",W,[e("div",X,[s[4]||(s[4]=e("div",{class:"bg-gradient"},null,-1)),e("div",Y,[(u(),c(q,null,z(20,t=>e("div",{key:t,class:"particle",style:G(U())},null,4)),64))])]),e("div",ee,[e("div",te,[e("div",se,[s[5]||(s[5]=e("div",{class:"logo"},[e("svg",{width:"48",height:"48",viewBox:"0 0 48 48",fill:"none"},[e("rect",{x:"4",y:"8",width:"40",height:"32",rx:"4",stroke:"currentColor","stroke-width":"2"}),e("path",{d:"M20 18L30 24L20 30V18Z",fill:"currentColor"})])],-1)),e("h1",null,n(a(l)("app.name")),1),e("p",null,n(a(l)("app.subtitle")),1)]),e("form",{onSubmit:R(D,["prevent"]),class:"login-form"},[x.value?(u(),c("div",oe,n(a(l)("login.loginProtection")),1)):L("",!0),e("div",le,[e("label",null,n(a(l)("login.username")),1),f(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>b.value=t),type:"text",class:"input",placeholder:a(l)("login.enterUsername"),required:""},null,8,ae),[[C,b.value]])]),e("div",ne,[e("label",null,n(a(l)("login.password")),1),f(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>y.value=t),type:"password",class:"input",placeholder:a(l)("login.enterPassword"),required:""},null,8,ie),[[C,y.value]])]),e("div",re,[e("label",null,n(a(l)("login.captcha")),1),e("div",ce,[f(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>v.value=t),type:"text",class:"input captcha-input",placeholder:a(l)("login.enterCaptcha"),required:"",maxlength:"4"},null,8,ue),[[C,v.value]]),e("div",{class:"captcha-image",onClick:k,innerHTML:V.value},null,8,de)])]),e("div",pe,[e("label",ge,[f(e("input",{"onUpdate:modelValue":s[3]||(s[3]=t=>w.value=t),type:"checkbox",class:"checkbox"},null,512),[[j,w.value]]),e("span",null,n(a(l)("login.rememberMe")),1)])]),h.value?(u(),c("div",ve,[H(n(h.value)+" ",1),_.value>0&&x.value?(u(),c("span",he,n(P("login.failedAttempts",{count:_.value})),1)):L("",!0)])):L("",!0),e("button",{type:"submit",class:"btn btn-primary login-btn",disabled:m.value},[m.value?(u(),c("span",_e)):(u(),c("span",fe,n(a(l)("login.loginBtn")),1))],8,me)],32)])]),I(Q)]))}},Le=K(be,[["__scopeId","data-v-90eb88c0"]]);export{Le as default};
