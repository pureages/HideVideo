import{G as Z,u as ke,a as be,o as we,s as Me,c as i,i as ee,b as e,h as E,t as s,d as v,F,r as H,e as h,f as te,x as ae,E as m,z as Ce,m as Be,j as g,D as y,B as Ve,C as xe,n}from"./index--Q4BRkWj.js";import{l as Ae}from"./library-a6NBLKfb.js";import{V as Fe,v as G}from"./VideoPlayer-QGm-AeJc.js";import{_ as Le,A as Pe}from"./AppFooter-Deo1k4jp.js";import{T as De}from"./TopNav-B-jgEhDd.js";import"./actor-CwJ4gNpB.js";const Ie={getLibraryPath(S){return Z.get(`/libraries/${S}/path`)},getLibraryFiles(S,T){const R={};return T&&(R.path=T),Z.get(`/libraries/${S}/files`,{params:R})}},ze={class:"filemanager-page"},Ne={class:"content"},Ee={class:"page-header"},He=["title"],Se={class:"filemanager-container"},Te={class:"sidebar"},Re={class:"sidebar-header"},$e={class:"library-list"},Ge=["onClick"],Ue={class:"library-name"},je={key:0,class:"empty-library"},Oe={class:"main-content"},Ke={key:0,class:"toolbar"},qe={class:"toolbar-left"},We=["disabled"],Je={class:"toolbar-right"},Qe={class:"filter-group"},Xe={value:""},Ye={value:"created_at_desc"},Ze={value:"created_at_asc"},et={value:"play_count_desc"},tt={value:"play_count_asc"},at={value:"rating_desc"},ot={value:"rating_asc"},st={class:"filter-group"},nt={value:""},it={value:"video"},lt={key:1,class:"breadcrumb"},rt=["onClick"],ut={class:"file-list-container"},ct={key:0,class:"loading-state"},dt={key:1,class:"empty-state"},vt={key:2,class:"empty-state"},ht={key:0},ft=["onClick"],pt={class:"file-info"},_t={class:"file-name"},gt={key:1,class:"section-divider"},yt=["onClick"],mt=["src"],kt={key:1,width:"100%",height:"100%",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},bt={class:"file-info"},wt={class:"file-name"},Mt={class:"file-meta"},Ct={key:0,class:"video-extra-info"},Bt={key:0,class:"play-count"},Vt={key:1,class:"video-rating"},xt={key:3,class:"section-divider"},At={class:"file-info"},Ft={class:"file-name"},Lt={class:"file-meta"},Pt={key:2,class:"status-bar"},Dt={key:0},It={key:1},zt={__name:"FileManager",setup(S){const T=Be(),R=ke(),{t:d,locale:U}=be();function k(o,a){try{let t=U==null?void 0:U.value;(!t||typeof t!="string")&&(t="zh-CN");let l=t==="en"?Ve:xe;const c=o.split(".");let u=l;for(const _ of c)if(u&&typeof u=="object")u=u[_];else return o;return typeof u!="string"?o:(a&&Object.keys(a).forEach(_=>{u=u.replace(new RegExp("{{"+_+"}}","g"),a[_])}),u)}catch(t){return console.error("Translation error:",t),o}}const L=g(!1),j=g([]),r=g(null),p=g(""),C=g([]),M=g(""),B=g(""),O=g(!1),P=g(null),D=g([]),b=g(0),f=g({}),V=[".mp4",".mkv",".ogg",".mv",".avi",".rmvb",".MP4",".MKV",".OGG",".MV",".AVI",".RMVB",".wmv",".flv",".webm",".mov"],q=y(()=>{if(!p.value||!r.value)return[];const o=p.value.replace(r.value.path,"");return o?o.split("/").filter(a=>a):[]}),W=y(()=>r.value&&p.value&&p.value!==r.value.path),$=y(()=>M.value==="video"?C.value.filter(o=>o.isDir?!0:V.includes(o.extension)):C.value),I=y(()=>$.value.filter(o=>o.isDir)),x=y(()=>{const o=$.value.filter(t=>!t.isDir&&V.includes(t.extension));if(!B.value)return o;const a=[...o];switch(B.value){case"created_at_desc":a.sort((t,l)=>{const c=f.value[t.path]||{};return((f.value[l.path]||{}).created_at||"").localeCompare(c.created_at||"")});break;case"created_at_asc":a.sort((t,l)=>{const c=f.value[t.path]||{},u=f.value[l.path]||{};return(c.created_at||"").localeCompare(u.created_at||"")});break;case"play_count_desc":a.sort((t,l)=>{const c=f.value[t.path]||{};return((f.value[l.path]||{}).play_count||0)-(c.play_count||0)});break;case"play_count_asc":a.sort((t,l)=>{const c=f.value[t.path]||{},u=f.value[l.path]||{};return(c.play_count||0)-(u.play_count||0)});break;case"rating_desc":a.sort((t,l)=>{const c=f.value[t.path]||{};return((f.value[l.path]||{}).rating||0)-(c.rating||0)});break;case"rating_asc":a.sort((t,l)=>{const c=f.value[t.path]||{},u=f.value[l.path]||{};return(c.rating||0)-(u.rating||0)});break}return a}),z=y(()=>$.value.filter(o=>!o.isDir&&!V.includes(o.extension))),oe=y(()=>I.value.length),se=y(()=>x.value.length),ne=y(()=>z.value.length),w=y(()=>"medium");we(async()=>{if(!(await R.checkAuth()).is_login){T.push("/login");return}await ie()}),Me(C,async o=>{o&&o.length>0&&await re()},{immediate:!0});async function ie(){L.value=!0;try{const o=await Ae.getLibraries();j.value=o}catch(o){console.error("获取视频库失败:",o)}finally{L.value=!1}}async function le(o){r.value=o,p.value=o.path,M.value="",B.value="",await A()}async function A(){if(r.value){L.value=!0;try{const o=await Ie.getLibraryFiles(r.value.id,p.value);C.value=o.files}catch(o){console.error("获取文件列表失败:",o)}finally{L.value=!1}}}async function re(){const o=C.value.filter(a=>!a.isDir&&V.includes(a.extension));for(const a of o)try{const t=await G.getVideoByPath(a.path,r.value.id);if(t.video&&t.video.id){const l=await G.getVideo(t.video.id);f.value[a.path]=l}}catch{}}function J(o){const a=f.value[o];return a&&a.cover_path?a.cover_path.startsWith("/")?a.cover_path:"/"+a.cover_path:null}function N(o){return f.value[o]}function ue(o){p.value=o,A()}function ce(){if(!W.value)return;const o=p.value.substring(0,p.value.lastIndexOf("/"));o===r.value.path?p.value=r.value.path:p.value=o,A()}function de(){p.value=r.value.path,A()}function ve(o){const a=q.value.slice(0,o+1),t=r.value.path+"/"+a.join("/");p.value=t,A()}function Q(){A()}function he(){}function fe(){}async function pe(o){if(V.includes(o.extension))try{const t=(await G.getVideoByPath(o.path,r.value.id)).video,l=C.value.filter(_=>!_.isDir&&V.includes(_.extension)),c=[];for(const _ of l)try{const K=await G.getVideoByPath(_.path,r.value.id);c.push(K.video)}catch(K){console.error("获取视频记录失败:",_.name,K)}const u=c.findIndex(_=>_.filepath===o.path);D.value=c,b.value=u>=0?u:0,P.value=t,O.value=!0}catch(a){console.error("获取视频信息失败:",a)}}function X(){O.value=!1,P.value=null}function _e(){b.value>0&&(b.value--,P.value=D.value[b.value])}function ge(){b.value<D.value.length-1&&(b.value++,P.value=D.value[b.value])}function ye(){X(),Q()}function Y(o){if(!o)return"0 B";const a=["B","KB","MB","GB","TB"];let t=0;for(;o>=1024&&t<a.length-1;)o/=1024,t++;return o.toFixed(2)+" "+a[t]}function me(o){return o?o.replace(".","").toUpperCase():""}return(o,a)=>(n(),i("div",ze,[ee(De),e("div",Ne,[e("div",Ee,[e("h1",null,[E(s(v(d)("fileManager.folderMode"))+" ",1),e("span",{class:"help-icon",title:v(d)("fileManager.folderModeHint")},"?",8,He)])]),e("div",Se,[e("div",Te,[e("div",Re,[e("h3",null,s(v(d)("fileManager.quickAccess")),1)]),e("div",$e,[(n(!0),i(F,null,H(j.value,t=>{var l;return n(),i("div",{key:t.id,class:m(["library-item",{active:((l=r.value)==null?void 0:l.id)===t.id}]),onClick:c=>le(t)},[a[2]||(a[2]=e("div",{class:"library-icon"},[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"})])],-1)),e("span",Ue,s(t.name),1)],10,Ge)}),128)),j.value.length===0?(n(),i("div",je,s(v(d)("fileManager.noLibraries")),1)):h("",!0)])]),e("div",Oe,[r.value?(n(),i("div",Ke,[e("div",qe,[e("button",{class:"btn btn-secondary",onClick:ce,disabled:!W.value},[a[3]||(a[3]=e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"15 18 9 12 15 6"})],-1)),E(" "+s(v(d)("fileManager.goBack")),1)],8,We),e("button",{class:"btn btn-secondary",onClick:Q},[a[4]||(a[4]=e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"23 4 23 10 17 10"}),e("polyline",{points:"1 20 1 14 7 14"}),e("path",{d:"M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"})],-1)),E(" "+s(v(d)("fileManager.refresh")),1)])]),e("div",Je,[e("div",Qe,[e("label",null,s(v(d)("fileManager.sortBy")),1),te(e("select",{"onUpdate:modelValue":a[0]||(a[0]=t=>B.value=t),class:"filter-select",onChange:fe},[e("option",Xe,s(v(d)("fileManager.sortDefault")),1),e("option",Ye,s(v(d)("fileManager.sortCreatedDesc")),1),e("option",Ze,s(v(d)("fileManager.sortCreatedAsc")),1),e("option",et,s(v(d)("fileManager.sortPlayCountDesc")),1),e("option",tt,s(v(d)("fileManager.sortPlayCountAsc")),1),e("option",at,s(v(d)("fileManager.sortRatingDesc")),1),e("option",ot,s(v(d)("fileManager.sortRatingAsc")),1)],544),[[ae,B.value]])]),e("div",st,[e("label",null,s(v(d)("fileManager.filterBy")),1),te(e("select",{"onUpdate:modelValue":a[1]||(a[1]=t=>M.value=t),class:"filter-select",onChange:he},[e("option",nt,s(v(d)("fileManager.filterAll")),1),e("option",it,s(v(d)("fileManager.filterVideo")),1)],544),[[ae,M.value]])])])])):h("",!0),r.value?(n(),i("div",lt,[e("span",{class:"breadcrumb-item",onClick:de},s(r.value.name),1),p.value?(n(),i(F,{key:0},[a[5]||(a[5]=e("span",{class:"breadcrumb-separator"},"/",-1)),(n(!0),i(F,null,H(q.value,(t,l)=>(n(),i("span",{key:l,class:"breadcrumb-item",onClick:c=>ve(l)},s(t),9,rt))),128))],64)):h("",!0)])):h("",!0),e("div",ut,[L.value?(n(),i("div",ct,[...a[6]||(a[6]=[e("div",{class:"spinner"},null,-1),e("span",null,"加载中...",-1)])])):r.value?$.value.length===0?(n(),i("div",vt,[a[8]||(a[8]=e("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1"},[e("path",{d:"M13 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V9z"}),e("polyline",{points:"13 2 13 9 20 9"})],-1)),e("h3",null,s(M.value==="video"?k("fileManager.noVideoFiles"):k("fileManager.emptyFolder")),1),M.value==="video"?(n(),i("p",ht,s(k("fileManager.noVideosInFolder")),1)):h("",!0)])):(n(),i("div",{key:3,class:m(["file-list",w.value])},[I.value.length>0?(n(!0),i(F,{key:0},H(I.value,t=>(n(),i("div",{key:t.path,class:m(["file-item folder",w.value]),onClick:l=>ue(t.path)},[e("div",{class:m(["file-icon folder-icon",w.value])},[...a[9]||(a[9]=[e("svg",{width:"100%",height:"100%",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("path",{d:"M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"})],-1)])],2),e("div",pt,[e("span",_t,s(t.name),1),a[10]||(a[10]=e("span",{class:"file-meta"},"文件夹",-1))])],10,ft))),128)):h("",!0),I.value.length>0&&x.value.length>0?(n(),i("div",gt,[e("span",null,"视频文件 ("+s(x.value.length)+")",1)])):h("",!0),x.value.length>0?(n(!0),i(F,{key:2},H(x.value,t=>(n(),i("div",{key:t.path,class:m(["file-item video",w.value]),onClick:l=>pe(t)},[e("div",{class:m(["file-icon video-icon",w.value])},[J(t.path)?(n(),i("img",{key:0,src:J(t.path),class:m(["video-cover",w.value])},null,10,mt)):(n(),i("svg",kt,[...a[11]||(a[11]=[e("polygon",{points:"5 3 19 12 5 21 5 3"},null,-1)])]))],2),e("div",bt,[e("span",wt,s(t.name),1),e("span",Mt,s(Y(t.size))+" · "+s(me(t.extension)),1),N(t.path)?(n(),i("div",Ct,[N(t.path).play_count?(n(),i("span",Bt,[a[12]||(a[12]=e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polygon",{points:"5 3 19 12 5 21 5 3"})],-1)),E(" "+s(N(t.path).play_count),1)])):h("",!0),N(t.path).rating?(n(),i("span",Vt,[a[13]||(a[13]=e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor"},[e("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})],-1)),E(" "+s(N(t.path).rating),1)])):h("",!0)])):h("",!0)])],10,yt))),128)):h("",!0),(I.value.length>0||x.value.length>0)&&z.value.length>0?(n(),i("div",xt,[e("span",null,"其他文件 ("+s(z.value.length)+")",1)])):h("",!0),z.value.length>0?(n(!0),i(F,{key:4},H(z.value,t=>(n(),i("div",{key:t.path,class:m(["file-item other",w.value])},[e("div",{class:m(["file-icon other-icon",w.value])},[...a[14]||(a[14]=[e("svg",{width:"100%",height:"100%",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("path",{d:"M13 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V9z"}),e("polyline",{points:"13 2 13 9 20 9"})],-1)])],2),e("div",At,[e("span",Ft,s(t.name),1),e("span",Lt,s(Y(t.size))+" · "+s(t.extension),1)])],2))),128)):h("",!0)],2)):(n(),i("div",dt,[a[7]||(a[7]=e("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1"},[e("path",{d:"M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"})],-1)),e("h3",null,s(k("fileManager.selectLibrary")),1),e("p",null,s(k("fileManager.selectLibraryHint")),1)]))]),r.value?(n(),i("div",Pt,[e("span",null,s(k("fileManager.statusFolders",{folderCount:oe.value,videoCount:se.value,otherFileCount:ne.value})),1),M.value==="video"?(n(),i("span",Dt,"("+s(k("fileManager.filterVideo"))+")",1)):h("",!0),B.value?(n(),i("span",It,s(k("fileManager.sorted")),1)):h("",!0)])):h("",!0)])])]),O.value?(n(),Ce(Fe,{key:0,video:P.value,videoList:D.value,currentIndex:b.value,onClose:X,onPrevVideo:_e,onNextVideo:ge,onDeleted:ye},null,8,["video","videoList","currentIndex"])):h("",!0),ee(Pe)]))}},$t=Le(zt,[["__scopeId","data-v-cb4ae6ff"]]);export{$t as default};
