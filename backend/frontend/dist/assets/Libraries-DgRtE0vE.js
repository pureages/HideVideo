import{u as Z,a as ee,o as te,c as u,i as U,b as t,t as o,d as l,h as f,F as se,r as re,e as B,w as S,f as F,v as A,E as ae,m as le,j as n,l as H,n as v}from"./index--Q4BRkWj.js";import{l as w}from"./library-a6NBLKfb.js";import{_ as oe,A as ie}from"./AppFooter-Deo1k4jp.js";import{T as ne}from"./TopNav-B-jgEhDd.js";const de={class:"libraries-page"},ce={class:"content"},ue={class:"page-header"},ve={class:"header-actions"},be=["disabled"],he={key:0,width:"16",height:"16",viewBox:"0 0 24 24",class:"spinner-icon"},pe={key:1,width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},fe={class:"libraries-list"},me={class:"library-info"},ye={class:"library-path"},ge={class:"library-meta"},we={class:"library-date"},ke={class:"library-actions"},_e=["onClick","disabled"],Ce={key:0,width:"16",height:"16",viewBox:"0 0 24 24",class:"spinner-icon"},xe={key:1,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Le=["onClick"],Me=["onClick"],Ne={key:0,class:"empty-state"},Be={class:"modal-content add-modal"},Se={class:"modal-header"},Ve={class:"form-group"},Ie=["placeholder"],$e={class:"form-group"},Fe=["placeholder"],Ae={class:"form-hint"},He={class:"modal-actions"},Te=["disabled"],ze={class:"modal-content cover-modal"},De={class:"modal-header"},Pe={class:"form-group"},Ue=["placeholder"],Ee={class:"form-hint"},Oe={class:"cover-actions"},Re={class:"cover-buttons"},qe=["disabled"],je=["disabled"],Je={class:"cover-tooltip"},Ge={class:"tooltip-text"},Ke={class:"modal-actions",style:{"margin-top":"1rem"}},Qe={__name:"Libraries",setup(We){const E=le(),O=Z(),{t:r,locale:R}=ee();function _(a,e){var P;const s=((P=H.global.locale)==null?void 0:P.value)||H.global.locale||R.value||"zh-CN",i=H.global.messages;if(!i)return a;let b=i[s];if(!b&&s.includes("-")){const g=s.split("-")[0];b=i[g]}if(b||(b=i["zh-CN"]),!b)return a;const Y=a.split(".");let h=b;for(const g of Y)h=h==null?void 0:h[g];return h?(e&&Object.keys(e).forEach(g=>{h=h.replace(new RegExp("{{"+g+"}}","g"),e[g])}),h):a}const V=n(!0),I=n([]),p=n(!1),m=n(!1),C=n(!1),k=n(!1),x=n(null),y=n(!1),$=n(null),L=n(1),M=n(""),T=n("success"),d=n({name:"",path:""});function q(){d.value={name:"",path:""}}function z(){q();try{const a=localStorage.getItem("hidevideo_library_form");if(a){const e=JSON.parse(a);d.value.name=e.name||"",d.value.path=e.path||""}}catch(a){console.error("加载保存的表单失败:",a)}}function j(){try{localStorage.setItem("hidevideo_library_form",JSON.stringify({name:d.value.name,path:d.value.path}))}catch(a){console.error("保存表单失败:",a)}}te(async()=>{if(!(await O.checkAuth()).is_login){E.push("/login");return}await N()});async function N(){V.value=!0;try{const a=await w.getLibraries();console.log("Libraries response:",a),I.value=a}catch{c(r("errors.getUserInfoFailed"),"error")}finally{V.value=!1}}async function J(){var a,e;C.value=!0;try{const s=d.value.name,i=d.value.path;console.log("Adding library:",{name:s,path:i});const b=await w.addLibrary(s,i);console.log("Add library response:",b),j(),p.value=!1,d.value={name:"",path:""},await N(),c(r("errors.saved"),"success")}catch(s){c(((e=(a=s.response)==null?void 0:a.data)==null?void 0:e.error)||r("errors.addUserFailed"),"error")}finally{C.value=!1}}async function G(a){var e,s;x.value=a.id;try{const i=await w.scanLibrary(a.id);c(_("libraries.scanComplete",{added:i.added,skipped:i.skipped}),"success")}catch(i){c(((s=(e=i.response)==null?void 0:e.data)==null?void 0:s.error)||r("errors.updateFailed"),"error")}finally{x.value=null}}async function K(){var a,e;if(confirm(r("libraries.confirmCleanInvalid"))){k.value=!0;try{const s=await w.cleanInvalidIndex();c(_("libraries.cleanComplete",{deletedVideos:s.deleted_videos,deletedCovers:s.deleted_covers,deletedOrphanCovers:s.deleted_orphan_covers,deletedLibraries:s.deleted_libraries||0}),"success"),await N()}catch(s){c(((e=(a=s.response)==null?void 0:a.data)==null?void 0:e.error)||r("errors.deleteFailed"),"error")}finally{k.value=!1}}}function Q(a){$.value=a,L.value=1,m.value=!0}async function D(a="reset"){var e,s;if($.value){y.value=!0;try{const i=await w.generateCovers($.value.id,L.value,a);m.value=!1,c(_("libraries.thumbnailComplete",{success:i.success,failed:i.failed}),"success")}catch(i){c(((s=(e=i.response)==null?void 0:e.data)==null?void 0:s.error)||r("errors.updateFailed"),"error")}finally{y.value=!1}}}async function W(a){var e,s;if(confirm(_("libraries.confirmDeleteLibrary",{name:a.name})))try{await w.deleteLibrary(a.id),await N(),c(r("errors.deleted"),"success")}catch(i){c(((s=(e=i.response)==null?void 0:e.data)==null?void 0:s.error)||r("errors.deleteFailed"),"error")}}function X(a){if(!a)return"-";const e=new Date(a);return isNaN(e.getTime())?"-":e.toLocaleDateString("zh-CN")}function c(a,e="success"){M.value=a,T.value=e,setTimeout(()=>{M.value=""},3e3)}return(a,e)=>(v(),u("div",de,[U(ne),t("div",ce,[t("div",ue,[t("h1",null,o(l(r)("libraries.title")),1),t("div",ve,[t("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=s=>{z(),p.value=!0})},[e[13]||(e[13]=t("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),t("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)),f(" "+o(l(r)("libraries.addLibrary")),1)]),t("button",{class:"btn btn-warning",onClick:K,disabled:k.value},[k.value?(v(),u("svg",he,[...e[14]||(e[14]=[t("circle",{cx:"12",cy:"12",r:"10",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-dasharray":"30 70"},null,-1)])])):(v(),u("svg",pe,[...e[15]||(e[15]=[t("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"},null,-1),t("line",{x1:"10",y1:"11",x2:"10",y2:"17"},null,-1),t("line",{x1:"14",y1:"11",x2:"14",y2:"17"},null,-1)])])),f(" "+o(k.value?l(r)("libraries.cleaning"):l(r)("libraries.cleanInvalidIndex")),1)],8,be)])]),t("div",fe,[(v(!0),u(se,null,re(I.value,s=>(v(),u("div",{key:s.id,class:"library-card"},[e[20]||(e[20]=t("div",{class:"library-icon"},[t("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[t("path",{d:"M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"})])],-1)),t("div",me,[t("h3",null,o(s.name),1),t("p",ye,o(s.path),1),t("div",ge,[t("span",we,"创建于 "+o(X(s.created_at)),1)])]),t("div",ke,[t("button",{class:"btn btn-primary",onClick:i=>G(s),disabled:x.value===s.id},[x.value===s.id?(v(),u("svg",Ce,[...e[16]||(e[16]=[t("circle",{cx:"12",cy:"12",r:"10",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-dasharray":"30 70"},null,-1)])])):(v(),u("svg",xe,[...e[17]||(e[17]=[t("circle",{cx:"11",cy:"11",r:"8"},null,-1),t("path",{d:"M21 21l-4.35-4.35"},null,-1)])])),f(" "+o(l(r)("libraries.scanAll")),1)],8,_e),t("button",{class:"btn btn-secondary",onClick:i=>Q(s)},[e[18]||(e[18]=t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),t("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),t("polyline",{points:"21 15 16 10 5 21"})],-1)),f(" "+o(l(r)("libraries.thumbnail")),1)],8,Le),t("button",{class:"btn btn-danger",onClick:i=>W(s)},[e[19]||(e[19]=t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"3 6 5 6 21 6"}),t("path",{d:"M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})],-1)),f(" "+o(l(r)("libraries.delete")),1)],8,Me)])]))),128)),I.value.length===0&&!V.value?(v(),u("div",Ne,[e[21]||(e[21]=t("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1"},[t("path",{d:"M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"})],-1)),t("h3",null,o(l(r)("libraries.noLibraries")),1),t("p",null,o(l(r)("libraries.addLibraryHint")),1),t("button",{class:"btn btn-primary",onClick:e[1]||(e[1]=s=>{z(),p.value=!0})},o(l(r)("libraries.addLibrary")),1)])):B("",!0)])]),p.value?(v(),u("div",{key:0,class:"modal-overlay",onClick:e[6]||(e[6]=S(s=>p.value=!1,["self"]))},[t("div",Be,[t("div",Se,[t("h2",null,o(l(r)("libraries.addModalTitle")),1),t("button",{class:"close-btn",onClick:e[2]||(e[2]=s=>p.value=!1)},[...e[22]||(e[22]=[t("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])])]),t("form",{onSubmit:S(J,["prevent"]),class:"modal-form"},[t("div",Ve,[t("label",null,o(l(r)("libraries.libraryName")),1),F(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>d.value.name=s),type:"text",class:"input",placeholder:l(r)("libraries.libraryNamePlaceholder"),required:""},null,8,Ie),[[A,d.value.name]])]),t("div",$e,[t("label",null,o(l(r)("libraries.folderPath")),1),F(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>d.value.path=s),type:"text",class:"input",placeholder:l(r)("libraries.folderPathPlaceholder"),required:""},null,8,Fe),[[A,d.value.path]]),t("p",Ae,o(l(r)("libraries.folderPathHint")),1)]),t("div",He,[t("button",{type:"button",class:"btn btn-secondary",onClick:e[5]||(e[5]=s=>p.value=!1)},o(l(r)("common.cancel")),1),t("button",{type:"submit",class:"btn btn-primary",disabled:C.value},o(C.value?l(r)("libraries.adding"):l(r)("libraries.add")),9,Te)])],32)])])):B("",!0),m.value?(v(),u("div",{key:1,class:"modal-overlay",onClick:e[12]||(e[12]=S(s=>m.value=!1,["self"]))},[t("div",ze,[t("div",De,[t("h2",null,o(l(r)("libraries.generateThumbnail")),1),t("button",{class:"close-btn",onClick:e[7]||(e[7]=s=>m.value=!1)},[...e[23]||(e[23]=[t("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])])]),t("form",{onSubmit:e[11]||(e[11]=S(s=>D("reset"),["prevent"])),class:"modal-form"},[t("div",Pe,[t("label",null,o(l(r)("libraries.captureSecond")),1),F(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>L.value=s),type:"number",class:"input",min:"0",placeholder:l(r)("libraries.captureSecondPlaceholder"),required:""},null,8,Ue),[[A,L.value,void 0,{number:!0}]]),t("p",Ee,o(l(r)("libraries.captureSecondHint")),1)]),t("div",Oe,[t("div",Re,[t("button",{type:"button",class:"btn btn-secondary",onClick:e[9]||(e[9]=s=>D("new")),disabled:y.value},o(y.value?l(r)("libraries.adding"):l(r)("libraries.generateNew")),9,qe),t("button",{type:"submit",class:"btn btn-primary",disabled:y.value},o(y.value?l(r)("libraries.adding"):l(r)("libraries.resetAll")),9,je)]),t("div",Je,[e[25]||(e[25]=t("span",{class:"tooltip-icon"},"?",-1)),t("span",Ge,[f(o(l(r)("libraries.generateNewHint")),1),e[24]||(e[24]=t("br",null,null,-1)),f(" "+o(l(r)("libraries.resetAllHint")),1)])])]),t("div",Ke,[t("button",{type:"button",class:"btn btn-secondary",onClick:e[10]||(e[10]=s=>m.value=!1),style:{width:"100%"}},o(l(r)("common.cancel")),1)])],32)])])):B("",!0),M.value?(v(),u("div",{key:2,class:ae(["result-toast",T.value])},o(M.value),3)):B("",!0),U(ie)]))}},tt=oe(Qe,[["__scopeId","data-v-a0c503fa"]]);export{tt as default};
