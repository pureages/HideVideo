import{q as ue,j as d,a as ve,u as he,s as O,o as pe,c as i,i as K,b as t,t as n,F as z,r as M,e as f,d as h,h as $,f as R,x as U,p as ge,y as q,z as fe,m as ye,A as me,B as _e,C as xe,D as ke,n as l,g as be,E as H}from"./index--Q4BRkWj.js";import{v as Se,V as we}from"./VideoPlayer-QGm-AeJc.js";import{l as Ce}from"./library-a6NBLKfb.js";import{t as Ve,a as Ie}from"./actor-CwJ4gNpB.js";import{_ as Pe,A as Ae}from"./AppFooter-Deo1k4jp.js";import{T as Be}from"./TopNav-B-jgEhDd.js";const ze=ue("video",()=>{const D=d([]),k=d(0),p=d(1),N=d(24),b=d(0),r=d("created_at"),m=d("desc"),S=d(""),w=d([]),I=d([]),a=d(parseInt(localStorage.getItem("randomSeed"))||0);async function g(){const c={page:p.value,page_size:N.value,sort_by:r.value,order:m.value,keyword:S.value,library_ids:w.value.join(","),tag_ids:I.value.join(","),random_seed:r.value==="random"?a.value:void 0};Object.keys(c).forEach(u=>{(c[u]===""||c[u]===null||c[u]===void 0)&&delete c[u]});try{const u=await Se.getVideos(c);return D.value=u.list,k.value=u.total,p.value=u.page,b.value=u.total_pages,!0}catch(u){return console.error(u),D.value=[],k.value=0,p.value=1,b.value=0,!1}}function L(c){p.value=c,g()}function T(c){N.value=c,p.value=1,g()}function P(c,u,V=!1){if(r.value=c,m.value=u,c==="random"){const y=parseInt(localStorage.getItem("randomSeed"))||0;V||y===0?(a.value=Math.floor(Math.random()*1e6)+1,localStorage.setItem("randomSeed",a.value)):a.value=y}p.value=1,g()}function _(c){S.value=c,p.value=1,g()}function A(c){w.value=c,p.value=1,g()}function C(c){I.value=c,p.value=1,g()}return{videos:D,total:k,page:p,pageSize:N,totalPages:b,sortBy:r,order:m,keyword:S,selectedLibraryIds:w,selectedTagIds:I,randomSeed:a,fetchVideos:g,setPage:L,setPageSize:T,setSort:P,setKeyword:_,setSelectedLibraryIds:A,setSelectedTagIds:C}}),Le={class:"home-page"},Te={class:"main-container"},Me={class:"sidebar"},$e={class:"sidebar-section"},De={class:"library-list"},Ne=["value"],Fe={class:"checkbox-label"},Oe={key:0,class:"empty-text"},Re={class:"sidebar-section"},je={class:"tag-list"},Ee=["onClick"],Ue={key:0,class:"empty-text"},Ke={class:"content"},qe={class:"toolbar"},He={class:"toolbar-left"},Ge={class:"video-count"},Je={class:"toolbar-right"},Qe={class:"display-settings"},We={class:"sort-options"},Xe={value:"created_at-desc"},Ye={value:"created_at-asc"},Ze={value:"play_count-desc"},et={value:"play_count-asc"},tt={value:"rating-desc"},ot={value:"rating-asc"},st={value:"random"},at={key:0,class:"search-result-header"},nt={class:"search-result-info"},lt={key:1,class:"filter-banner"},it={key:2,class:"loading-container"},rt=["onClick"],dt={class:"video-cover"},ct=["src","alt"],ut={key:1,class:"cover-placeholder"},vt={class:"video-duration"},ht={class:"video-info"},pt=["title"],gt={class:"video-meta"},ft={key:0,class:"rating"},yt={key:1,class:"play-count"},mt={key:0,class:"video-tags"},_t={key:4,class:"empty-state"},xt={key:5,class:"loading"},kt={key:6,class:"pagination-wrapper"},bt={class:"pagination"},St=["disabled"],wt={key:0,class:"page-ellipsis"},Ct=["onClick"],Vt=["disabled"],It={__name:"Home",setup(D){const k=ye(),p=me(),{t:N,locale:b}=ve();function r(o,e){try{let s=b==null?void 0:b.value;(!s||typeof s!="string")&&(s="zh-CN");let v=s==="en"?_e:xe;const ce=o.split(".");let x=v;for(const F of ce)if(x&&typeof x=="object")x=x[F];else return o;return typeof x!="string"?o:(e&&Object.keys(e).forEach(F=>{x=x.replace(new RegExp("{{"+F+"}}","g"),e[F])}),x)}catch(s){return console.error("Translation error:",s),o}}const m=d(null),S=d([]),w=d(!1),I=he(),a=ze(),g=d(!0),L=d([]),T=d([]),P=d([]),_=d([]),A=d(""),C=d(parseInt(localStorage.getItem("pageSize"))||24),c=d(parseInt(localStorage.getItem("gridCols"))||4),u=d(localStorage.getItem("sortOption")||"created_at-desc");O(C,o=>{localStorage.setItem("pageSize",o)}),O(c,o=>{localStorage.setItem("gridCols",o)}),O(u,o=>{localStorage.setItem("sortOption",o)});const V=d(!1),y=d(null),B=d(0),G=ke(()=>{const o=a.totalPages,e=a.page,s=[];if(o<=7)for(let v=1;v<=o;v++)s.push(v);else e<=3?s.push(1,2,3,4,"...",o):e>=o-2?s.push(1,"...",o-3,o-2,o-1,o):s.push(1,"...",e-1,e,e+1,"...",o);return s});pe(async()=>{if(await I.checkAuth(),!I.isLogin){k.push("/login");return}await Promise.all([J(),Q()]);const o=p.query.actor;o&&(m.value=parseInt(o),await W(m.value));const[e,s]=u.value.split("-");u.value==="random"?a.setSort("random","desc"):a.setSort(e,s),a.setPageSize(C.value),await a.fetchVideos(),g.value=!1}),O([P,_],()=>{a.setSelectedLibraryIds(P.value),a.setSelectedTagIds(_.value)},{deep:!0});async function J(){try{const o=await Ce.getLibraries();L.value=o}catch(o){console.error(o)}}async function Q(){try{const o=await Ve.getTags();T.value=o}catch(o){console.error(o)}}async function W(o){w.value=!0;try{const e=await Ie.getActorVideos(o);S.value=e.list||[]}catch(e){console.error(e)}finally{w.value=!1}}function X(o){const e=_.value.indexOf(o);e===-1?_.value.push(o):_.value.splice(e,1)}function Y(){a.setKeyword(A.value)}function Z(){A.value="",a.setKeyword("")}function ee(){a.setPageSize(C.value)}function te(){const[o,e]=u.value.split("-"),s=o==="random";a.setSort(o,e,s)}function j(o){a.setPage(o),window.scrollTo({top:0,behavior:"smooth"})}function oe(o){if(!o)return"00:00";const e=Math.floor(o/3600),s=Math.floor(o%3600/60),v=Math.floor(o%60);return e>0?`${e}:${s.toString().padStart(2,"0")}:${v.toString().padStart(2,"0")}`:`${s}:${v.toString().padStart(2,"0")}`}function E(o){if(!o)return"";const e=o.lastIndexOf(".");return e>0?o.substring(0,e):o}function se(o){y.value=o,B.value=a.videos.findIndex(e=>e.id===o.id),V.value=!0}function ae(){const o=B.value-1;o>=0&&(B.value=o,y.value=a.videos[o])}function ne(o){let e;o!=null?e=o:e=B.value+1,e>=0&&e<a.videos.length&&(B.value=e,y.value=a.videos[e])}function le(){V.value=!1,y.value=null}function ie(){V.value=!1,y.value=null,a.fetchVideos()}async function re(o){V.value=!1,y.value=null,k.push({path:"/",query:{actor:o.id.toString()}})}function de(){m.value=null,S.value=[],k.push({path:"/"})}return(o,e)=>(l(),i("div",Le,[K(Be,{"show-search":!0,modelValue:A.value,"onUpdate:modelValue":e[0]||(e[0]=s=>A.value=s),onSearch:Y},null,8,["modelValue"]),t("div",Te,[t("aside",Me,[t("div",$e,[t("h3",null,n(r("home.videoLibraryFilter")),1),t("div",De,[(l(!0),i(z,null,M(L.value,s=>(l(),i("label",{key:s.id,class:"checkbox-item"},[R(t("input",{type:"checkbox",value:s.id,"onUpdate:modelValue":e[1]||(e[1]=v=>P.value=v)},null,8,Ne),[[be,P.value]]),e[8]||(e[8]=t("span",{class:"checkbox-custom"},null,-1)),t("span",Fe,n(s.name),1)]))),128)),L.value.length===0?(l(),i("p",Oe,n(r("home.noLibraries")),1)):f("",!0)])]),t("div",Re,[t("h3",null,n(r("home.tagFilter")),1),t("div",je,[(l(!0),i(z,null,M(T.value,s=>(l(),i("button",{key:s.id,class:H(["tag-btn",{active:_.value.includes(s.id)}]),onClick:v=>X(s.id)},n(s.name),11,Ee))),128)),T.value.length===0?(l(),i("p",Ue,n(r("home.noTags")),1)):f("",!0)])])]),t("main",Ke,[t("div",qe,[t("div",He,[t("span",Ge,n(r("home.totalVideos",{count:h(a).total})),1)]),t("div",Je,[t("div",Qe,[t("label",null,[$(n(r("home.perPage"))+" ",1),R(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>C.value=s),onChange:ee,class:"select"},[...e[9]||(e[9]=[t("option",{value:12},"12",-1),t("option",{value:24},"24",-1),t("option",{value:48},"48",-1)])],544),[[U,C.value]])]),t("label",null,[$(n(r("home.grid"))+" ",1),R(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>c.value=s),class:"select"},[...e[10]||(e[10]=[t("option",{value:3},"3x4",-1),t("option",{value:4},"4x3",-1),t("option",{value:5},"5x3",-1),t("option",{value:6},"6x3",-1)])],512),[[U,c.value]])])]),t("div",We,[R(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>u.value=s),onChange:te,class:"select"},[t("option",Xe,n(r("home.sortCreatedDesc")),1),t("option",Ye,n(r("home.sortCreatedAsc")),1),t("option",Ze,n(r("home.sortPlayCountDesc")),1),t("option",et,n(r("home.sortPlayCountAsc")),1),t("option",tt,n(r("home.sortRatingDesc")),1),t("option",ot,n(r("home.sortRatingAsc")),1),t("option",st,n(r("home.sortRandom")),1)],544),[[U,u.value]])])])]),h(a).keyword?(l(),i("div",at,[t("div",nt,n(r("home.searchResult",{keyword:h(a).keyword,count:h(a).total})),1),t("button",{class:"btn btn-secondary",onClick:Z},[e[11]||(e[11]=t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M18 6L6 18M6 6l12 12"})],-1)),$(" "+n(r("home.cancelSearch")),1)])])):f("",!0),m.value?(l(),i("div",lt,[t("span",null,n(r("home.actorFilterResult")),1),t("button",{class:"btn btn-secondary btn-sm",onClick:de},n(r("home.clearFilter")),1)])):f("",!0),w.value?(l(),i("div",it,[e[12]||(e[12]=t("div",{class:"spinner"},null,-1)),t("p",null,n(r("common.loading")),1)])):(l(),i("div",{key:3,class:"video-grid",style:ge({"--cols":c.value})},[(l(!0),i(z,null,M(m.value?S.value:h(a).videos,s=>(l(),i("div",{key:s.id,class:"video-card",onClick:v=>se(s)},[t("div",dt,[s.cover_path?(l(),i("img",{key:0,src:s.cover_path,alt:E(s.filename)},null,8,ct)):(l(),i("div",ut,[...e[13]||(e[13]=[q('<svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" data-v-4a97f538><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18" data-v-4a97f538></rect><line x1="7" y1="2" x2="7" y2="22" data-v-4a97f538></line><line x1="17" y1="2" x2="17" y2="22" data-v-4a97f538></line><line x1="2" y1="12" x2="22" y2="12" data-v-4a97f538></line><line x1="2" y1="7" x2="7" y2="7" data-v-4a97f538></line><line x1="2" y1="17" x2="7" y2="17" data-v-4a97f538></line><line x1="17" y1="17" x2="22" y2="17" data-v-4a97f538></line><line x1="17" y1="7" x2="22" y2="7" data-v-4a97f538></line></svg>',1)])])),e[14]||(e[14]=t("div",{class:"video-overlay"},[t("div",{class:"play-icon"},[t("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"currentColor"},[t("polygon",{points:"5 3 19 12 5 21 5 3"})])])],-1)),t("div",vt,n(oe(s.duration)),1)]),t("div",ht,[t("h4",{class:"video-title",title:E(s.filename)},n(E(s.filename)),9,pt),t("div",gt,[s.rating>0?(l(),i("span",ft,[e[15]||(e[15]=t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor"},[t("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})],-1)),$(" "+n(s.rating.toFixed(1)),1)])):f("",!0),s.play_count>0?(l(),i("span",yt,[e[16]||(e[16]=t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polygon",{points:"5 3 19 12 5 21 5 3"})],-1)),$(" "+n(s.play_count),1)])):f("",!0)]),s.tags&&s.tags.length>0?(l(),i("div",mt,[(l(!0),i(z,null,M(s.tags.slice(0,3),v=>(l(),i("span",{key:v.id,class:"tag"},n(v.name),1))),128))])):f("",!0)])],8,rt))),128))],4)),h(a).videos.length===0&&!g.value?(l(),i("div",_t,[e[17]||(e[17]=q('<svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" data-v-4a97f538><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18" data-v-4a97f538></rect><line x1="7" y1="2" x2="7" y2="22" data-v-4a97f538></line><line x1="17" y1="2" x2="17" y2="22" data-v-4a97f538></line><line x1="2" y1="12" x2="22" y2="12" data-v-4a97f538></line><line x1="2" y1="7" x2="7" y2="7" data-v-4a97f538></line><line x1="2" y1="17" x2="7" y2="17" data-v-4a97f538></line><line x1="17" y1="17" x2="22" y2="17" data-v-4a97f538></line><line x1="17" y1="7" x2="22" y2="7" data-v-4a97f538></line></svg>',1)),t("p",null,n(r("home.noVideos")),1),t("button",{class:"btn btn-primary",onClick:e[5]||(e[5]=s=>o.$router.push("/libraries"))},n(r("home.addLibrary")),1)])):f("",!0),g.value?(l(),i("div",xt,[...e[18]||(e[18]=[t("div",{class:"spinner"},null,-1)])])):f("",!0),h(a).totalPages>1?(l(),i("div",kt,[t("div",bt,[t("button",{class:"pagination-btn",disabled:h(a).page<=1,onClick:e[6]||(e[6]=s=>j(h(a).page-1))},[...e[19]||(e[19]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"15 18 9 12 15 6"})],-1)])],8,St),(l(!0),i(z,null,M(G.value,s=>(l(),i(z,{key:s},[s==="..."?(l(),i("span",wt,"...")):(l(),i("button",{key:1,class:H(["pagination-btn",{active:s===h(a).page}]),onClick:v=>j(s)},n(s),11,Ct))],64))),128)),t("button",{class:"pagination-btn",disabled:h(a).page>=h(a).totalPages,onClick:e[7]||(e[7]=s=>j(h(a).page+1))},[...e[20]||(e[20]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"9 18 15 12 9 6"})],-1)])],8,Vt)])])):f("",!0)])]),V.value?(l(),fe(we,{key:0,video:y.value,"video-list":h(a).videos,"current-index":B.value,onClose:le,onPrevVideo:ae,onNextVideo:ne,onDeleted:ie,onClickActor:re},null,8,["video","video-list","current-index"])):f("",!0),K(Ae)]))}},Mt=Pe(It,[["__scopeId","data-v-4a97f538"]]);export{Mt as default};
